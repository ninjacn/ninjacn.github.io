---
layout: post
status: publish
published: true
title: 'ip_conntrack: table full, dropping packet.'
author:
  display_name: Ninjacn
  login: admin
  email: x@ninjacn.com
  url: ''
author_login: admin
author_email: x@ninjacn.com
excerpt: "WEBæœåŠ¡å™¨åšå‹åŠ›æµ‹è¯•æ—¶ï¼Œé”™è¯¯LOGï¼š\r\n\r\nNov 10 15:42:13 web01 kernel: ip_conntrack: table
  full, dropping packet.\r\nNov 10 15:42:19 web01 kernel: printk: 204 messages suppressed.\r\nNov
  10 15:42:19 web01 kernel: ip_conntrack: table full, dropping packet.\r\nNov 10 15:42:25
  web01 kernel: printk: 204 messages suppressed.\r\n\r\nTELNETè¿æ¥80ç«¯å£ä¹Ÿè¿æ¥ä¸ä¸Šã€‚\r\n\r\n[root@web
  ~]# cat &#47;proc&#47;sys&#47;net&#47;ipv4&#47;netfilter&#47;ip_conntrack_max<span
  style=\"DISPLAY: none\">IXPUBæŠ€æœ¯åšå®¢\x06O\ei0D+J+V\x17c\x1E^<&#47;span>\r\n65536\r\n\r\nåæ¥æ·»åŠ ip_conntrack_maxå€¼æœ‰æ‰€å¥½è½¬ï¼š\r\n\r\necho
  \"262144\" > &#47;proc&#47;sys&#47;net&#47;ipv4&#47;ip_conntrack_max\r\n\r\n<strong>è¿˜æœ‰æ›´å¤šä¼˜åŒ–å‚æ•°ï¼šè¯¦ç»†å¯ä»¥å‚è€ƒä»¥ä¸‹ï¼š"
wordpress_id: 757
wordpress_url: http://ninjacn.com/?p=757
date: '2009-11-10 16:58:32 +0800'
date_gmt: '2009-11-10 08:58:32 +0800'
categories:
- System
tags:
- linux
- ip_conntrack
comments: []
---
<p>WEBæœåŠ¡å™¨åšå‹åŠ›æµ‹è¯•æ—¶ï¼Œé”™è¯¯LOGï¼š</p>
<p>Nov 10 15:42:13 web01 kernel: ip_conntrack: table full, dropping packet.<br />
Nov 10 15:42:19 web01 kernel: printk: 204 messages suppressed.<br />
Nov 10 15:42:19 web01 kernel: ip_conntrack: table full, dropping packet.<br />
Nov 10 15:42:25 web01 kernel: printk: 204 messages suppressed.</p>
<p>TELNETè¿æ¥80ç«¯å£ä¹Ÿè¿æ¥ä¸ä¸Šã€‚</p>
<p>[root@web ~]# cat &#47;proc&#47;sys&#47;net&#47;ipv4&#47;netfilter&#47;ip_conntrack_max<span style="DISPLAY: none">IXPUBæŠ€æœ¯åšå®¢Oi0D+J+Vc^<&#47;span><br />
65536</p>
<p>åæ¥æ·»åŠ ip_conntrack_maxå€¼æœ‰æ‰€å¥½è½¬ï¼š</p>
<p>echo "262144" > &#47;proc&#47;sys&#47;net&#47;ipv4&#47;ip_conntrack_max</p>
<p><strong>è¿˜æœ‰æ›´å¤šä¼˜åŒ–å‚æ•°ï¼šè¯¦ç»†å¯ä»¥å‚è€ƒä»¥ä¸‹ï¼š<a id="more"></a><a id="more-757"></a><&#47;strong></p>
<p>å¯è°ƒæ•´ä»¥ä¸‹å‚æ•°ï¼š</p>
<p>echo 180 > &#47;proc&#47;sys&#47;net&#47;ipv4&#47;netfilter&#47;ip_conntrack_tcp_timeout_established<br />
echo 262144 > &#47;proc&#47;sys&#47;net&#47;ipv4&#47;netfilter&#47;ip_conntrack_max<br />
echo 120&nbsp;&nbsp; > &#47;proc&#47;sys&#47;net&#47;ipv4&#47;neigh&#47;default&#47;gc_stale_time<br />
echo 1024 > &#47;proc&#47;sys&#47;net&#47;ipv4&#47;neigh&#47;default&#47;gc_thresh1<br />
echo 4096 > &#47;proc&#47;sys&#47;net&#47;ipv4&#47;neigh&#47;default&#47;gc_thresh2<br />
echo 8192 > &#47;proc&#47;sys&#47;net&#47;ipv4&#47;neigh&#47;default&#47;gc_thresh3</p>
<p>æˆ–vi &#47;etc&#47;sysctl.conf</p>
<p>net.ipv4.ip_conntrack_max = 655360<br />
net.ipv4.netfilter.ip_conntrack_tcp_timeout_established = 180</p>
<p>å†sysctl -p</p>
<p>ç›¸å…³å‚æ•°è¯´æ˜ï¼š</p>
<p>ARP æ”¯æŒä¸€ä¸ª sysctl æ¥å£ï¼Œå¯ä»¥ç”¨ä»¥é…ç½®å…¨å±€å‚æ•°æˆ–é€ä¸ªç½‘ç»œæ¥å£åœ°è¿›è¡Œé…åˆ¶ã€‚ è¯¥ sysctl å¯ä»¥é€šè¿‡ <strong>&#47;proc&#47;sys&#47;net&#47;ipv4&#47;neigh&#47;*&#47;*<&#47;strong> æ–‡ä»¶æˆ–è€…ä½¿ç”¨ <strong>sysctl<&#47;strong>(2) æ¥å£æ¥è®¿é—®ã€‚ç³»ç»Ÿä¸­æ¯ä¸ªæ¥å£éƒ½åœ¨ &#47;proc&#47;sys&#47;net&#47;ipv4&#47;neigh&#47;. ä¸­æœ‰è‡ªå·±çš„ç›®å½•ã€‚`default'ç›®å½•ä¸­çš„è®¾ç½®ç”¨äºæ‰€æœ‰æ–°å»ºçš„è®¾å¤‡ã€‚ sysctl ç›¸å…³çš„æ—¶é—´æ˜¯ä»¥ç§’ä¸ºå•ä½ï¼Œé™¤éç‰¹åˆ«å£°æ˜è¿‡ï¼ <a href="http:&#47;&#47;bbs.ixdba.net&#47;" target="_blank"><strong>IXDBA.NETç¤¾åŒºè®ºå›<&#47;strong><&#47;a></p>
<p align="left"><strong>anycast_delay<&#47;strong><&#47;p></p>
<p align="left">å¯¹ IPv6 ç›¸é‚»è¯·æ±‚ä¿¡æ¯çš„å›å¤çš„æœ€å¤§å»¶è¿Ÿæ—¶é—´ï¼› ç›®å‰è¿˜ä¸æ”¯æŒ anycastã€‚ç¼ºçœå€¼ä¸º1ç§’ã€‚<&#47;p></p>
<p align="left"><strong>app_solicit<&#47;strong><&#47;p></p>
<p align="left">è¿™æ˜¯åœ¨ä½¿ç”¨å¤šè·¯å¹¿æ’­æ¢æµ‹(multicast probe)å‰ï¼Œ ç»è¿‡ç½‘ç»œè¿æ¥é€åˆ°ç”¨æˆ·é—´éš™ARPç«¯å£ç›‘æ§ç¨‹åºçš„æ¢æµ‹ï¼ˆprobeï¼‰ æœ€å¤§æ•°ç›®(è§ <em>mcast_solicit<&#47;em> )ã€‚ ç¼ºçœå€¼ä¸º0ã€‚<&#47;p></p>
<p align="left"><strong>base_reachable_time<&#47;strong><&#47;p></p>
<p align="left">ä¸€æ—¦å‘ç°ç›¸é‚»è®°å½•ï¼Œè‡³å°‘åœ¨ä¸€æ®µä»‹äº <em>base_reachable_time<&#47;em>&#47;2å’Œ3*<em>base_reachable_time<&#47;em>&#47;2 ä¹‹é—´çš„éšæœºæ—¶é—´å†…ï¼Œè¯¥è®°å½•æ˜¯æœ‰æ•ˆçš„ã€‚å¦‚æœæ”¶åˆ°ä¸Šå±‚åè®®çš„è‚¯å®šåé¦ˆï¼Œ é‚£ä¹ˆè®°å½•çš„æœ‰æ•ˆæœŸå°†å»¶é•¿ã€‚ ç¼ºçœå€¼æ˜¯30ç§’ã€‚<&#47;p></p>
<p align="left"><strong>delay_first_probe_time<&#47;strong><&#47;p></p>
<p align="left">å‘ç°æŸä¸ªç›¸é‚»å±‚è®°å½•æ— æ•ˆ(stale)åï¼Œå‘å‡ºç¬¬ä¸€ä¸ªæ¢æµ‹è¦ç­‰å¾…çš„æ—¶é—´ã€‚ ç¼ºçœå€¼æ˜¯5ç§’ã€‚<&#47;p></p>
<p align="left"><strong>gc_interval<&#47;strong><&#47;p></p>
<p align="left">æ”¶é›†ç›¸é‚»å±‚è®°å½•çš„æ— ç”¨è®°å½•çš„åƒåœ¾æ”¶é›†ç¨‹åºçš„è¿è¡Œå‘¨æœŸï¼Œç¼ºçœä¸º30ç§’ã€‚<&#47;p></p>
<p align="left"><strong>gc_stale_time<&#47;strong><&#47;p></p>
<p align="left">å†³å®šæ£€æŸ¥ä¸€æ¬¡ç›¸é‚»å±‚è®°å½•çš„æœ‰æ•ˆæ€§çš„å‘¨æœŸã€‚ å½“ç›¸é‚»å±‚è®°å½•å¤±æ•ˆæ—¶ï¼Œå°†åœ¨ç»™å®ƒå‘é€æ•°æ®å‰ï¼Œå†è§£æä¸€æ¬¡ã€‚ ç¼ºçœå€¼æ˜¯60ç§’ã€‚<&#47;p></p>
<p align="left"><strong>gc_thresh1<&#47;strong><&#47;p></p>
<p align="left">å­˜åœ¨äºARPé«˜é€Ÿç¼“å­˜ä¸­çš„æœ€å°‘å±‚æ•°ï¼Œå¦‚æœå°‘äºè¿™ä¸ªæ•°ï¼Œ åƒåœ¾æ”¶é›†å™¨å°†ä¸ä¼šè¿è¡Œã€‚ç¼ºçœå€¼æ˜¯128ã€‚<&#47;p></p>
<p align="left"><strong>gc_thresh2<&#47;strong><&#47;p></p>
<p align="left">ä¿å­˜åœ¨ ARP é«˜é€Ÿç¼“å­˜ä¸­çš„æœ€å¤šçš„è®°å½•è½¯é™åˆ¶ã€‚ åƒåœ¾æ”¶é›†å™¨åœ¨å¼€å§‹æ”¶é›†å‰ï¼Œå…è®¸è®°å½•æ•°è¶…è¿‡è¿™ä¸ªæ•°å­— 5 ç§’ã€‚ ç¼ºçœå€¼æ˜¯ 512ã€‚<&#47;p></p>
<p align="left"><strong>gc_thresh3<&#47;strong><&#47;p></p>
<p align="left">ä¿å­˜åœ¨ ARP é«˜é€Ÿç¼“å­˜ä¸­çš„æœ€å¤šè®°å½•çš„ç¡¬é™åˆ¶ï¼Œ ä¸€æ—¦é«˜é€Ÿç¼“å­˜ä¸­çš„æ•°ç›®é«˜äºæ­¤ï¼Œ åƒåœ¾æ”¶é›†å™¨å°†é©¬ä¸Šè¿è¡Œã€‚ç¼ºçœå€¼æ˜¯1024ã€‚<&#47;p></p>
<p align="left"><strong>locktime<&#47;strong><&#47;p></p>
<p align="left">ARP è®°å½•ä¿å­˜åœ¨é«˜é€Ÿç¼“å­˜å†…çš„æœ€çŸ­æ—¶é—´ï¼ˆjiffyæ•°ï¼‰ï¼Œ ä»¥é˜²æ­¢å­˜åœ¨å¤šä¸ªå¯èƒ½çš„æ˜ å°„(potential mapping)æ—¶ï¼Œ ARP é«˜é€Ÿç¼“å­˜ç³»ç»Ÿçš„é¢ ç°¸ (ç»å¸¸æ˜¯ç”±äºç½‘ç»œçš„é”™è¯¯é…ç½®è€Œå¼•èµ·)ã€‚ ç¼ºçœå€¼æ˜¯ 1 ç§’ã€‚<&#47;p></p>
<p align="left"><strong>mcast_solicit<&#47;strong><&#47;p></p>
<p align="left">åœ¨æŠŠè®°å½•æ ‡è®°ä¸ºä¸å¯æŠµè¾¾çš„ä¹‹å‰ï¼Œ ç”¨å¤šè·¯å¹¿æ’­&#47;å¹¿æ’­ï¼ˆmulticast&#47;broadcastï¼‰æ–¹å¼è§£æåœ°å€çš„æœ€å¤§æ¬¡æ•°ã€‚<&#47;p></p>
