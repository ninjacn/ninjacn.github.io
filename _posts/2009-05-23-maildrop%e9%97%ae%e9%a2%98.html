---
layout: post
status: publish
published: true
title: maildrop问题
author:
  display_name: Ninjacn
  login: admin
  email: x@ninjacn.com
  url: ''
author_login: admin
author_email: x@ninjacn.com
excerpt: |
  因为要用到maildrop的过滤功能，所以用maildrop作为LDA（本地投递代理）

  如果是用的虚拟用户需要配置为VDA（虚拟投递代理）

  客户的系统直接是用的系统用户作为邮件用户，就不需要mysql的支持了，也省去很多麻烦

  使用maildrop投递邮件，结果maillog中出现Unable to open mailbox
  Feb 19 11:57:36 mail postfix&#47;local[26333]: C96C64E463: to=, orig_to=, relay=local, delay=280472, status=deferred (temporary failure. Command output: &#47;usr&#47;local&#47;bin&#47;maildrop: Unable to open mailbox. )
wordpress_id: 511
wordpress_url: http://ninjacn.com/?p=511
date: '2009-05-23 22:15:25 +0800'
date_gmt: '2009-05-23 14:15:25 +0800'
categories:
- Server
tags:
- maildrop
- postfix
comments: []
---
<p>因为要用到maildrop的过滤功能，所以用maildrop作为LDA（本地投递代理）</p>
<p>如果是用的虚拟用户需要配置为VDA（虚拟投递代理）</p>
<p>客户的系统直接是用的系统用户作为邮件用户，就不需要mysql的支持了，也省去很多麻烦</p>
<p>使用maildrop投递邮件，结果maillog中出现Unable to open mailbox<br />
Feb 19 11:57:36 mail postfix&#47;local[26333]: C96C64E463: to=, orig_to=, relay=local, delay=280472, status=deferred (temporary failure. Command output: &#47;usr&#47;local&#47;bin&#47;maildrop: Unable to open mailbox. )<br />
<a id="more"></a><a id="more-511"></a></p>
<p>后来重新编译maildrop结果又提示Unable to create a dot-lock<br />
Feb 19 11:57:27 mail postfix&#47;local[26344]: CC6A64E6FD: to=, orig_to=, relay=local, delay=121513, status=deferred (temporary failure. Command output: &#47;usr&#47;local&#47;bin&#47;maildrop: Unable to create a dot-lock at &#47;home&#47;backup_eileenfeng&#47;Maildir&#47;.Trash&#47;26561.0.mail.acorn.com.cn. )</p>
<p>因为是系统用户认证，没有采用虚拟用户，所以尝试修改&#47;home&#47;的权限，设置set-uid&#47;gid都不起作用。<br />
最后在一个网站找到了解决办法<br />
http:&#47;&#47;usenet.jyxo.cz&#47;cz.comp.li ... maildrop-howto.html</p>
<p>vi &#47;etc&#47;postfix&#47;main.cf<br />
mailbox_command = &#47;usr&#47;local&#47;bin&#47;maildrop<br />
#官方网站的配置后面还有一个-d ${USER}<br />
http:&#47;&#47;www.postfix.org&#47;MAILDROP_README.html</p>
<p>local_destination_concurrency_limit = 1<br />
重新编译maildrop<br />
make distclean<br />
先运行.&#47;configure<br />
然后修改maildrop&#47;config.h<br />
#define DEFAULT_DEF "&#47;var&#47;mail"<br />
为<br />
#define DEFAULT_DEF ".&#47;Maildir"<br />
make &amp;&amp; make install<br />
然后再测试发送邮件，maillog就不报错了</p>
