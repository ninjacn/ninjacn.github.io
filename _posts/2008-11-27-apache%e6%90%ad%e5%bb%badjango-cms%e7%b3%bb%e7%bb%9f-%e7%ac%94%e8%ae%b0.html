---
layout: post
status: publish
published: true
title: apache搭建django-cms(fastcgi)系统--笔记
author:
  display_name: Ninjacn
  login: admin
  email: x@ninjacn.com
  url: ''
author_login: admin
author_email: x@ninjacn.com
excerpt: |
  因为公司业务都是用django开发的，所有必须得找一个用django开发的cms环境使用。结果找到了两个，一个是PyLucid CMS ，再就是django-cms了，我感觉后者好一点。目录结构一看就明白！！
  先贴一下http.conf
  <coolcode>
  <directory &#47;infoware&#47;djangocms>
  Order Allow,Deny
  Allow from All
  <&#47;directory>
  FastCGIExternalServer &#47;infoware&#47;djangocms&#47;mysite.fcgi -host 127.0.0.1:10000
  <virtualHost 192.168.0.181>
    ServerName cms.linuxnotes.com
    DocumentRoot &#47;infoware&#47;djangocms
    RewriteEngine On
    RewriteRule ^&#47;(media.*)$ &#47;$1 [QSA,L,PT]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^&#47;(.*)$ &#47;mysite.fcgi&#47;$1 [QSA,L]
  <&#47;virtualHost>
  <&#47;coolcode>
  以下是我的启动fastcgi脚本&#47;etc&#47;init.d&#47;djangocms.sh
wordpress_id: 218
wordpress_url: http://ninjacn.com/?p=218
date: '2008-11-27 14:22:02 +0800'
date_gmt: '2008-11-27 06:22:02 +0800'
categories:
- System
tags:
- apache
- django
- django-cms
- fastcgi
comments: []
---
<p>因为公司业务都是用django开发的，所有必须得找一个用django开发的cms环境使用。结果找到了两个，一个是PyLucid CMS ，再就是django-cms了，我感觉后者好一点。目录结构一看就明白！！<br />
先贴一下http.conf<br />
<coolcode><br />
<directory &#47;infoware&#47;djangocms><br />
Order Allow,Deny<br />
Allow from All<br />
<&#47;directory><br />
FastCGIExternalServer &#47;infoware&#47;djangocms&#47;mysite.fcgi -host 127.0.0.1:10000<br />
<virtualHost 192.168.0.181><br />
  ServerName cms.linuxnotes.com<br />
  DocumentRoot &#47;infoware&#47;djangocms<br />
  RewriteEngine On<br />
  RewriteRule ^&#47;(media.*)$ &#47;$1 [QSA,L,PT]<br />
  RewriteCond %{REQUEST_FILENAME} !-f<br />
  RewriteRule ^&#47;(.*)$ &#47;mysite.fcgi&#47;$1 [QSA,L]<br />
<&#47;virtualHost><br />
<&#47;coolcode><br />
以下是我的启动fastcgi脚本&#47;etc&#47;init.d&#47;djangocms.sh<br />
<a id="more"></a><a id="more-218"></a><br />
<coolcode><br />
#!&#47;bin&#47;bash<br />
PROJDIR="&#47;infoware&#47;djangocms&#47;"<br />
PIDFILE="&#47;var&#47;run&#47;djangocms.pid"<br />
PYTHON='&#47;usr&#47;bin&#47;python'<br />
HOST=127.0.0.1<br />
PORT=10000<br />
#SOCKET='&#47;tmp&#47;djangocms.sock'<br />
#<br />
# source function library<br />
. &#47;etc&#47;rc.d&#47;init.d&#47;functions</p>
<p>RETVAL=0</p>
<p>start() {<br />
echo -n $"Starting djangocms-daemon: "<br />
# this script starts the daemon<br />
$PYTHON $PROJDIR&#47;manage.py runfcgi host=$HOST port=$PORT --setting=djangocms.settings method=prefork pidfile=$PIDFILE<br />
--pythonpath=$PROJDIR<br />
RETVAL=$?<br />
echo<br />
[ $RETVAL -eq 0 ] &amp;&amp; touch &#47;var&#47;lock&#47;subsys&#47;d-cms-daemon<br />
}</p>
<p>stop() {<br />
echo -n $"Stopping djangocms-daemon: "<br />
cd $PROJDIR<br />
if [ -f $PIDFILE ]; then<br />
kill `cat -- $PIDFILE`<br />
rm -f -- $PIDFILE<br />
fi<br />
echo<br />
[ $RETVAL -eq 0 ] &amp;&amp; rm -f &#47;var&#47;lock&#47;subsys&#47;d-cms-daemon<br />
}</p>
<p>restart() {<br />
stop<br />
start<br />
}<br />
case "$1" in<br />
start)<br />
start<br />
;;<br />
stop)<br />
stop<br />
;;<br />
restart|reload)<br />
restart<br />
;;<br />
condrestart)<br />
[ -f &#47;var&#47;lock&#47;subsys&#47;d-cms-daemon ] &amp;&amp; restart<br />
;;<br />
status)<br />
status d-cms-daemon<br />
RETVAL=$?<br />
;;<br />
*)<br />
echo $"Usage: $0 {start|stop|status|restart|reload|<br />
condrestart}"<br />
exit 1<br />
esac</p>
<p>exit $RETVAL<br />
<&#47;coolcode><br />
运行后发现admin，模板不能应用，apache logs显示：<br />
File does not exist: &#47;infoware&#47;djangocms&#47;media&#47;admin&#47;cms&#47;cms, referer: http:&#47;&#47;cms.linuxnotes.com&#47;admin&#47;cms&#47;page&#47;add&#47;<br />
查看目录文件的确是不存在，但按照这个CMS系统的安装文档是用链接的，后来运行DJANGO自带的SERVER运行，结果正常了，不解&hellip;&hellip;<br />
后来执行<br />
cp &#47;usr&#47;lib&#47;python2.4&#47;site-packages&#47;django&#47;contrib&#47;admin&#47;media&#47;* &#47;infoware&#47;djangocms&#47;media&#47;admin&#47;cms&#47; -R<br />
结果正常了。因为django自带的server运行admin调用的media文件不是WEB文件夹，而在django目录下。但当用WEB SERVER运行时，它会按照settings.py文件中的设置去找media文件，导致了以上问题，我安装的这个cms（r41）系统的版本与django（1.0）的版本不兼容。<br />
因公司WEB SERVER都用nginx，现只是apache测试可以运行，nginx运行会提示重写向循环，不知是什么原因？还得测试&hellip;&hellip;</p>
<p><span class="Apple-style-span" style="word-spacing: 0px; text-transform: none; color: #777777; text-indent: 0px; font-family: -webkit-monospace; letter-spacing: normal; border-collapse: separate; orphans: 2; widows: 2; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0;">&nbsp;:???: :???: :???: :???: <&#47;span></p>
