---
layout: post
status: publish
published: true
title: nagios插件检测DNS故障(check_dns)
author:
  display_name: Ninjacn
  login: admin
  email: x@ninjacn.com
  url: ''
author_login: admin
author_email: x@ninjacn.com
wordpress_id: 828
wordpress_url: http://ninjacn.com/?p=828
date: '2009-12-29 15:54:05 +0800'
date_gmt: '2009-12-29 07:54:05 +0800'
categories:
- System
tags:
- dns
- nagios
- "报警"
comments: []
---
<p>今天修改DNS服务器记录，不知不觉NAGIOS报警错误：<br />
[cc lang="bash"][root@dns ~]# &#47;opt&#47;nagios&#47;libexec&#47;check_dns 127.0.0.1<br />
Domain 127.0.0.1 was not found by the server[&#47;cc]</p>
<p>但DNS服务器还可以正常运行<br />
但检测GOOGLE DNS服务器却正常<br />
[cc lang="bash"][root@dns ~]# &#47;opt&#47;nagios&#47;libexec&#47;check_dns 8.8.8.8<br />
DNS OK: 5.141 seconds response time. 8.8.8.8 returns google-public-dns-a.google.com.|time=5.141241s;;;0.000000[&#47;cc]呵呵，有点慢。。</p>
<p>最后将nameserver 127.0.0.1 添加到&#47;etc&#47;resolv.conf文件后正常了。以前DNS服务器设置不允许所有IP递归，现将localhost添加进去<br />
[cc lang="bash"]vi &#47;etc&#47;named.conf<br />
allow-recursion { 127.0.0.1;none; };[&#47;cc]</p>
