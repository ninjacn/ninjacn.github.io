---
layout: post
status: publish
published: true
title: Linux Iptables Limit the number of incoming tcp connection &#47; syn-flood
  attacks
author:
  display_name: Ninjacn
  login: admin
  email: x@ninjacn.com
  url: ''
author_login: admin
author_email: x@ninjacn.com
excerpt: "A SYN flood is a form of denial-of-service attack in which an attacker sends
  a succession of SYN requests to a target's system. This is a well known type of
  attack and is generally not effective against modern networks. It works if a server
  allocates resources after receiving a SYN, but before it has received the ACK. \r\n\r\nif
  Half-open connections bind resources on the server, it may be possible to take up
  all these resources by flooding the server with SYN messages. Syn flood is common
  attack and it can be block with following iptables rules:\r\n"
wordpress_id: 747
wordpress_url: http://ninjacn.com/?p=747
date: '2009-10-15 17:53:54 +0800'
date_gmt: '2009-10-15 09:53:54 +0800'
categories:
- System
tags: []
comments: []
---
<p>A SYN flood is a form of denial-of-service attack in which an attacker sends a succession of SYN requests to a target's system. This is a well known type of attack and is generally not effective against modern networks. It works if a server allocates resources after receiving a SYN, but before it has received the ACK. </p>
<p>if Half-open connections bind resources on the server, it may be possible to take up all these resources by flooding the server with SYN messages. Syn flood is common attack and it can be block with following iptables rules:<br />
<a id="more"></a><a id="more-747"></a><br />
<code>iptables -A INPUT -p tcp --syn -m limit --limit 1&#47;s --limit-burst 3 -j RETURN<&#47;code><br />
All incoming connection are allowed till limit is reached:</p>
<p>--limit 1&#47;s: Maximum average matching rate in seconds<br />
--limit-burst 3: Maximum initial number of packets to match<br />
Open our iptables script, add the rules as follows:</p>
<p><code><br />
# Limit the number of incoming tcp connections<br />
# Interface 0 incoming syn-flood protection<br />
iptables -N syn_flood<br />
iptables -A INPUT -p tcp --syn -j syn_flood<br />
iptables -A syn_flood -m limit --limit 1&#47;s --limit-burst 3 -j RETURN<br />
iptables -A syn_flood -j DROP<br />
#Limiting the incoming icmp ping request:<br />
iptables -A INPUT -p icmp -m limit --limit  1&#47;s --limit-burst 1 -j ACCEPT</p>
<p>iptables -A INPUT -p icmp -m limit --limit 1&#47;s --limit-burst 1 -j LOG --log-prefix PING-DROP:<br />
iptables -A INPUT -p icmp -j DROP</p>
<p>iptables -A OUTPUT -p icmp -j ACCEPT<br />
<&#47;code><br />
First rule will accept ping connections to 1 per second, with an initial burst of 1. If this level crossed it will log the packet with PING-DROP in &#47;var&#47;log&#47;message file. Third rule will drop packet if it tries to cross this limit. Fourth and final rule will allow you to use the continue established ping request of existing connection.<br />
Where,</p>
<p>‐‐limit rate: Maximum average matching rate: specified as a number, with an optional &lsquo;&#47;second&rsquo;, &lsquo;&#47;minute&rsquo;, &lsquo;&#47;hour&rsquo;, or &lsquo;&#47;day&rsquo; suffix; the default is 3&#47;hour.<br />
‐‐limit‐burst number: Maximum initial number of packets to match: this number gets recharged by one every time the limit specified above is not reached, up to this number; the default is 5.<br />
You need to adjust the &ndash;limit-rate and &ndash;limit-burst according to your network traffic and requirements. </p>
<p>Let us assume that you need to limit incoming connection to ssh server (port 22) no more than 10 connections in a 10 minute:</p>
<p><code><br />
iptables -I INPUT -p tcp -s 0&#47;0 -d $SERVER_IP --sport 513:65535 --dport 22 -m state --state NEW,ESTABLISHED -m recent --set -j ACCEPT<br />
iptables -I INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 600 --hitcount 11 -j DROP<br />
iptables -A OUTPUT -p tcp -s $SERVER_IP -d 0&#47;0 --sport 22 --dport 513:65535 -m state --state ESTABLISHED -j ACCEPT<br />
<&#47;code><br />
See also:<br />
More information on recent patch can be found here</p>
